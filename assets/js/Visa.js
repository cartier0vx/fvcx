function ChangeCulture(n,t){var u=$(n).closest("ul"),i=$(n).closest("form"),r,f;i.append('<input type="hidden" name="culture" value="'+t+'" />');i.append('<input type="hidden" name="redirectWorkflow" value="'+mvcController+'" />');i.append('<input type="hidden" name="redirectAction" value="'+mvcAction+'" />');r=u.attr("aria-labelledby");f=r=="header-language-label"?"header":"footer";i.submit()}function initializeNavigationButtons(){$("body").on("click",".navigationButton:not(.primary)",function(){var n=$(this);return form=n.closest("form"),(form==null||form.prop("action")==null)&&(form=$("#MainForm")),formAction=form.prop("action"),newAction=formAction.split("/"),newAction.splice(newAction.length-2,2),location=newAction.join("/")+"/"+n.attr("data-route"),!1})}function setFormUrl(n){var i=n.closest("form"),r=i.prop("action"),t=r.split("/");t.splice(t.length-2,2);i.prop("action",t.join("/")+"/"+n.attr("data-route"))}function showValidationSummary(n){return n=n||$("div.message[data-visaAlert]"),$(n).show().attr({role:"alert","aria-hidden":"false"}),removeSuccessMessage(),removeWarningMessage(),scrollToFormTop(),n}function hideValidationSummary(n){return n=n||$("div.message[data-visaAlert]"),$(n).hide().attr({role:null,"aria-hidden":"true"}),n}function removeSuccessMessage(){$alertDiv=$("div .success[data-alert]");$alertDiv.remove()}function removeWarningMessage(){$alertDiv=$("div .warning[data-alert]");$alertDiv.length>0&&$alertDiv.hide()}function setModalWindow(n){var i=$(window).height(),u=$(window).scrollTop(),r=100,t=400;i<800&&(t=i-220-r-100,t<100&&(t=100),n.find(".scrollable").css({"max-height":t+"px"}));n.data("reveal-init",{animation:"fade",animation_speed:200,close_on_background_click:!1,close_on_esc:!0,dismiss_modal_class:"close-reveal-modal",bg_class:"reveal-modal-bg",bg:$(".reveal-modal-bg")||$("<div>",{"class":"reveal-modal-bg"}),css:{open:{opacity:0,visibility:"visible",display:"block",top:u+r},close:{opacity:1,visibility:"hidden",display:"none"}}});n.foundation("reveal","open")}function startTrackingAccessToken(){isAccessTokenRenewCheck&&(clearInterval(accessTokenTimer),setAccessTokenTimer())}function startTrackingSession(){if(trackSession){setSessionTimer();$(window).focus(stopBlinkingTitle);$(window).blur(function(){windowFocused=!1});$("body").on("click","a.close-reveal-modal",function(){clickSessionCancel&&sessionModal.is(":visible")&&sessionCancel.click()})}}function setAccessTokenTimer(){accessTokenTimer=setInterval(function(){renewAccessToken()},5e3)}function setSessionTimer(){var n=(sessionExpiresIn-sessionTimeout)*6e4-15e3;sessionTimeoutTimer=setTimeout(function(){showSessionModal()},n);$("body").on("submit",function(){return clearTimers(),!0})}function renewAccessToken(){var n=new Date-clientTimeRenewal,t;if(n&&n>=0){clearInterval(accessTokenTimer);return}t=Math.abs(new Date-clientTimeRenewal)/1e3;t<targetRenewalThreshold&&(clearInterval(accessTokenTimer),$.getJSON(baseUrl+mvcController+"/RenewAccessToken",function(n){n.IsTokenRenew&&!n.IsRenewCancelled?(clientTimeRenewal=new Date(n.clientTargetTime),setAccessTokenTimer()):n.IsRenewCancelled||setTimeout(renewAccessToken,15e3)}))}function showSessionModal(){sessionModal.hasClass("open")||$("#session-timeout-link").click();showInitial();$("#alertModalMsgBox",".reveal-modal, .small, .open").hide();timerIntervalId=setTimeout(function(){expireSession()},3e4);windowFocused||blinkTitle()}function clearTimers(){clearTimeout(sessionTimeoutTimer);clearInterval(timerIntervalId);clearInterval(blinkIntervalId)}function showActionAndMsg(){sessionAction.show();sessionCancel.show()}function showInitial(){sessionHeading.text(sessionTimingoutHeading);clickSessionCancel=!0;sessionAction.on("click",function(){extendSession()});sessionCancel.on("click",function(){expireSession(!0)});showActionAndMsg()}function showExtended(){sessionCancel.off("click");sessionHeading.text(sessionExtendedHeading);sessionMsg.hide();sessionAction.hide();sessionCancel.text(closeButtonText);sessionCancel.on("click",function(){closeExtended()})}function closeExtended(){clickSessionCancel=!1;$("#sessionTimeOutClose",sessionModal).click();setTimeout(function(){setSessionTimer()},100)}function showExpired(){sessionHeading.text(sessionHasExpired);sessionMsg.hide();sessionAction.hide();sessionCancel.text(okButtonText).attr("onclick","expireSessionAtServer(true)");$("#sessionTimeOutClose",sessionModal).on("click",function(){expireSessionAtServer(!0)})}function showExtensionError(){var n=$("<a>",{href:baseUrl+"verify/ExtendSessionError"}).appendTo("body");n.click()}function expireSession(n){clearTimers();n=n||!1;n?(expireSessionAtServer(n),setModalWindow($("#modal-loading"),$("<input>",{value:"load"}))):showExpired()}function expireSessionAtServer(n){n=n||!1;var t=$("<form>",{action:baseUrl+"Logout/Logout"}).appendTo("body");t.append($("<input>",{name:"byUser",id:"byUser",value:n})).submit()}function extendSession(){clearTimers();setSessionTimer();$.getJSON(baseUrl+mvcController+"/KeepAlive",function(){showExtended()}).error(function(){showExtensionError()})}function blinkTitle(){blinkIntervalId=setInterval(function(){var n=document.title;document.title=n==title?"Session Expiring Soon...":title},500)}function stopBlinkingTitle(){windowFocused||(windowFocused=!0,clearInterval(blinkIntervalId),document.title=title)}function visaModalCaller(){$("body").on("click","a[data-reveal-id],button[data-reveal-id],input[data-reveal-id]",function(n){var r;if(n.stopPropagation(),visaModal.beforeSubmit!=null&&(r=visaModal.beforeSubmit.call(this),!r))return!1;var t=$(this),e="#"+$(this).attr("data-reveal-id"),u=$(this),i=u.attr("id"),f={url:t.attr("data-href")||t.attr("href")||null,requestData:t.attr("data-requestdata")||null,requestType:t.attr("data-requesttype")||"GET",modal_id:"#"+t.attr("data-reveal-id"),element:this};return t.attr("data-reveal-ajax")=="true"?visaModal.getModelAsync(f):visaModal.getModel(f),(i===undefined||i===null)&&(i="trigger_"+(new Date).getTime(),u.attr("id",i)),$(e).attr("data-trigger-elm-id",i),!1})}function setModalHeight(n){var t,r,i;n&&(t=$(n).find(".modal-body"),modal&&t.hasClass("tagged")||(modal=$(n),r=$(".scrollable, .non-scrollable"),scrollArea=modal.find(r),i=scrollArea.height(),i<40&&scrollArea.height(i+10),t.addClass("tagged"),initialModalHeight=-1,initialScrollAreaHeight=-1,prevHeight=-1),modal_height=modal.height(),window_height=$(window).height(),room=window_height-modal_height,scrollAreaHeight=scrollArea.css("max-height").replace(/px/,"")*1,initialModalHeight==-1&&(initialModalHeight=modal_height),prevHeight==-1&&(prevHeight=window_height),initialScrollAreaHeight==-1&&(initialScrollAreaHeight=scrollAreaHeight),decreasing=prevHeight>=window_height,prevHeight=window_height,decreasing?handleDecrease():handleIncrease())}function handleDecrease(){decreaseTop()||squeezScrollArea()||squeezModal()}function decreaseTop(){return room>200?!0:(currentTop>minTop&&(currentTop=Math.floor(room*.5),currentTop<minTop&&(currentTop=minTop)),modal.css("top",currentTop+"px"),currentTop>minTop)}function squeezScrollArea(){var n=320+currentTop;return(window_height<800&&(scrollAreaHeight=window_height-n),scrollAreaHeight<=minScrollAreaHeight)?(scrollArea.css("max-height",minScrollAreaHeight+"px"),!1):(scrollArea.css("max-height",scrollAreaHeight+"px"),!0)}function squeezModal(){var n=window_height-20;n<modal_height&&$(modal).css({"max-height":n+"px",overflow:"auto"})}function handleIncrease(){expandModal()||expandScrollArea()||increaseTop()}function expandModal(){var n=window_height-currentTop,t=modal.css("max-height").replace(/px/,"")*1;return isNaN(t)||t>=initialModalHeight||n>=initialModalHeight?($(modal).css({"max-height":"",overflow:""}),!1):($(modal).css({"max-height":n+"px",overflow:"auto"}),!0)}function expandScrollArea(){var n=320+currentTop,t=scrollArea[0],i=t.clientHeight+1;return scrollAreaHeight>i?!1:(window_height<800&&(scrollAreaHeight=window_height-n),scrollAreaHeight>initialScrollAreaHeight)?(scrollArea.css("max-height",initialScrollAreaHeight+"px"),!1):(scrollAreaHeight<minScrollAreaHeight&&(scrollAreaHeight=minScrollAreaHeight),scrollArea.css("max-height",scrollAreaHeight+"px"),!0)}function increaseTop(){return(currentTop=Math.floor(room*.5),currentTop>maxTop)?(modal.css("top",maxTop+"px"),!1):(modal.css("top",currentTop+"px"),!0)}function setReveal(){$(document).foundation({reveal:{animation:"fade",animation_speed:200,close_on_background_click:!1,css:{open:{opacity:0,visibility:"visible",display:"block"},close:{opacity:1,visibility:"hidden",display:"none"}}}})}function bindCloseModalEvents(){$("body").on("click",".button-close-modal",function(){$("a.close-reveal-modal").trigger("click");visaModal.closeModal()});$(document).on("closed","[data-reveal]",function(){var i=$(this),r=$(".scrollable, .non-scrollable"),n,t;i.find(r).css("max-height","");$("form:first").find("[data-valmsg-summary]").removeClass("validation-summary-errors").attr("data-visaalert","").addClass("validation-summary-valid");visaModal.element!=null&&(n=$(visaModal.element).attr("data-focusIdOnClose"),n!=null&&(n="#"+n,$(n).is("input")?$(n).focus():(t=$(n).offset(),t.top-=170,$("html, body").animate({scrollTop:t.top,scrollLeft:t.left}))))})}function setModalFocus(){$(document).on("opened.fndtn.reveal","[data-reveal]",function(){var n=$(this),s=$(".scrollable, .non-scrollable"),u=n.find(".non-scrollable"),i=n.find(s),f=n.find("h2"),r=i.find("input,button,select,textarea").filter(":visible").first(),r=n.find("a,input,button,select,textarea").filter(":visible").first();r.length>0&&(r=u.find("a,input,button,select,textarea").filter(":visible").first());n.trap();r.length>0?r.focus():f.attr("tabindex")!==undefined?f.focus():n.find("input,button").filter(":visible").first().focus();var e=$(window).height(),o=400,t=200;u.length&&n.css({position:"absolute",top:$(window).scrollTop()+15+"px"});i.length&&u.length===0&&e<800&&(o=n.height(),t=i.height(),t=t-(o+12+100-e),t<100&&(t=100),i.css({"max-height":t+"px"}));$(document).on("mousedown.modal",function(t){var i=n.find(":focus");if($(t.target).hasClass("reveal-modal-bg"))return i.focus(),!1});$(document).on("closed","[data-reveal]",function(){var n=$(this),i=n.attr("data-trigger-elm-id"),f=n.attr("id"),r=$("#"+i),u=$(".scrollable, .non-scrollable"),t;n.find(u).css("max-height","");n.removeAttr("data-trigger-elm-id");t=$(this).attr("editAddressClicked");typeof t!=typeof undefined&&t=="true"?$("#ProfileHandler_Model_PostalAddress_AddressLine1").focus():r.focus();$(document).off("mousedown.modal")})})}function externalLinkModalForm(){var n="",t="",i="",r;$("a").each(function(){if($(this).attr("role")!="button"){var n=new RegExp("("+window.location.host+"|javascript\\:void\\(0\\)|visa|tel:)");this.href&&!n.test(this.href.toLowerCase())&&$(this).attr("data-reveal-id","modal-leaving-site")}});$('a[data-reveal-id="modal-leaving-site"]').click(function(){r=$(this).attr("href");n=$("#modal-leaving-site-text").text();i==""&&(i=n);t=i.replace("{0}",r);$("#modal-leaving-site-text").text(t)});$("#continue-button",$("#modal-leaving-site")).click(function(){$("#modal-leaving-site-text").text(t);window.open(r,"_blank")});$("#close-button, #modal-close-icon",$("#modal-leaving-site")).click(function(){setTimeout(function(){$("#modal-leaving-site-text").text(n)},250)})}function formatString(){for(var i,t=arguments[0],n=0;n<arguments.length-1;n++)i=new RegExp("\\{"+n+"\\}","gm"),t=t.replace(i,arguments[n+1]);return t}var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},scrollToFormTop,windowFocused,sessionTimeout,timerIntervalId,blinkIntervalId,accessTokenTimer,title,sessionModal,sessionAction,sessionActionInitialText,sessionActionInitialOnclick,sessionCancel,sessionCancelInitialText,sessionCancelInitialOnclick,sessionHeading,sessionClock,sessionMsg,clickSessionCancel,debugging,sessionTimeoutTimer;$(document).ready(function(){var n=!1;$("input[name=client-timezone-diff]").val((new Date).getTimezoneOffset());$(document).on("click","input[type='submit']",function(){clearInterval(accessTokenTimer);var t=$(this).closest("form");if(n)return!1;$.isFunction(t.valid)?t.valid()&&(n=!0):n=!0});$("#Print, #StandardPrint").on("click",function(){window.print()});$("input").on("focus",function(){$("input.cancel").attr("cancelClicked","");$("input.back").attr("cancelClicked","")});$(document).keypress(function(n){n.which==13&&(n.target.name=="Cancel"||n.target.name=="Back"?($("input.cancel").attr("cancelClicked","true"),$("input.back").attr("cancelClicked","true")):($("input.cancel").attr("cancelClicked","false"),$("input.back").attr("cancelClicked","false")))});$("input:submit").click(function(n){$(this).attr("cancelClicked")=="false"&&(n.stopPropagation(),n.preventDefault(),$('input.primary[type="button"]').click())});$(".changeCultureButton").on("click",function(){ChangeCulture(this,$(this).data("culture"))})});$(function(){$("body").on("click","a[data-dynamic-route]",function(){$(this).attr("href",baseUrl+$(this).attr("data-dynamic-route"));$(this).removeAttr("data-dynamic-route")})});$(document).ready(function(){initializeNavigationButtons()});$(document).ready(function(){$("form").bind("invalid-form.validate",function(n,t){var i=t.numberOfInvalids();i?showValidationSummary().css({visibility:"visible"}):hideValidationSummary().css({visibility:"visible"})});$("body").on("click","div.message[data-visaAlert] .close",function(){return hideValidationSummary($(this).parents("div.message")),!1});$("body").on("click","div.message[data-alert] .close",function(){$(this).parents("div.message").remove()})});scrollToFormTop=function(){return $("html, body").stop().animate({scrollTop:0},200),!1};$(function(){$("body").on("change",".showLoadingOnChange",function(){setModalWindow($("#modal-loading"))});$("body").on("click",".showLoadingOnClick",function(){setModalWindow($("#modal-loading"))});$("body").on("blur",".showLoadingOnBlur",function(){setModalWindow($("#modal-loading"))})});$(document).ready(function(){windowFocused=!0;sessionTimeout=1;timerIntervalId;blinkIntervalId;sessionTimeoutTimer;accessTokenTimer;title=document.title;sessionModal=$("#modal-session-timeout");sessionAction=$("#btn-extend-session");sessionActionInitialText=sessionAction.text();sessionActionInitialOnclick=sessionAction.attr("onclick");sessionCancel=$("#btn-expire-session");sessionCancelInitialText=sessionCancel.text();sessionCancelInitialOnclick=sessionCancel.attr("onclick");sessionHeading=$("h2",sessionModal);sessionClock=$("#session-time-left");sessionMsg=$(".expMessage",sessionModal);clickSessionCancel=!0;debugging=!1;requestIsRunning=!1;visaModalCaller();externalLinkModalForm();startTrackingSession();startTrackingAccessToken();bindCloseModalEvents();setModalFocus();$(window).resize(function(){visaModal.resize()});setReveal()});$(document).ajaxSuccess(function(n,t){t.responseJSON&&t.responseJSON.redirectTo&&(location=baseUrl+t.responseJSON.redirectTo)});var visaModal={modal_id:"#modalPlaceHolder",element:"",url:"",onSuccess:null,requestType:"GET",requestData:null,currentModal:null,errorHandler:function(){requestIsRunning=!1},resizeTimer:null,beforeSubmit:null,resize:function(n){(n=n||0,this.currentModal)&&(clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){setModalHeight(visaModal.currentModal)},n))},init:function(n){$.extend(this,n);var t=null;if(this.requestType=="POST"&&this.requestData==null){if(t=this.element!=null?$(this.element).closest("form"):$("form:first"),!t.valid())return!1;this.requestData=t.serialize()}return!0},getModelAsync:function(n){var t=this.init(n);t&&!requestIsRunning&&($.ajax({url:this.url,type:this.requestType,data:this.requestData,success:this.successHandler,error:this.errorHandler}),requestIsRunning=!0)},getModel:function(n){this.init(n);this.openModal()},successHandler:function(n,t){var i,r;if(requestIsRunning=!1,n.JAuthResult!=null)return n.JAuthResult=="true"?(n.Url&&(window.location.href=n.Url),!0):n.Url!="logout"?($("#modal-form-layout").find("[data-valmsg-summary]").removeClass("validation-summary-valid").addClass("validation-summary-errors").attr({"aria-hidden":"false"}).show(),$("#modal-form-layout").find("[data-valmsg-summary]").find("li").text(n.ErrorMessage).show(),!0):(i=$("<form>",{action:baseUrl+"Logout/Logout"}).appendTo("body"),i.append($("<input>",{name:"maxLoginAttemptsReached",id:"maxLoginAttemptsReached",value:"true"})).submit(),!0);if(n.Url)return window.location.href=n.Url,!0;r=$(visaModal.modal_id);r.html(n);visaModal.onSuccess!=null?visaModal.onSuccess.call(this,n,t):visaModal.openModal()},openModal:function(){if(this.modal_id){$(window).scrollTop(0);this.currentModal=$(this.modal_id);$(this.modal_id).foundation("reveal","open");this.resize(200);$("#modalPlaceHolder").attr("editAddressClicked","");var n=$("#modal-form-layout form");n!==undefined&&n.length>0&&$.isFunction(window.initVbaSubmit)&&initVbaSubmit(n)}},closeModal:function(){this.currentModal=null;this.modal_id!=null&&$(this.modal_id).foundation("reveal","close")}},prevHeight,initialScrollAreaHeight,initialModalHeight,window_height,modal_height,scrollAreaHeight,minScrollAreaHeight=100,maxScrollAreaHeight=400,room,scrollArea,bottomMargin=20,decreasing=!0,modal,currentTop=100,minTop=10,maxTop=100